steps:
  # Install dependencies with cache
  - name: python:3.11-slim
    id: install-deps
    entrypoint: bash
    args:
      - "-c"
      - |
        pip install --user --upgrade pip
        pip install --user -r requirements-gcp.txt
    volumes:
      - name: pip-cache
        path: /root/.cache/pip
  # Run tests
  - name: python:3.11-slim
    id: run-tests
    entrypoint: bash
    args:
      - "-c"
      - |
        python -m pytest test_hello.py
  # Store test results (optional)
  - name: gcr.io/cloud-builders/gsutil
    args: ["cp", "test-results.xml", "gs://your-bucket/test-results/"]
# Cache configuration
options:
  machineType: E2_HIGHCPU_8
  diskSizeGb: 100
  volumes:
    - name: pip-cache
      path: /root/.cache/pip
